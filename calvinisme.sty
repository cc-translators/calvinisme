\ProvidesPackage{calvinisme}

\usepackage[french]{babel} %language selection
\selectlanguage{french}

%\usepackage[utf8x]{inputenc}
% Set fonts
\usepackage{fontspec}
\usepackage{xunicode}
\setmainfont[Mapping=tex-text]{Linux Libertine O}
\newfontfamily\logofont{ChopinScript}
\newfontface\pagemarkfont[Numbers={OldStyle}]{Linux Libertine O}
\newfontfamily\headerfont{Linux Libertine Slanted O}
\newfontfamily\sigfont{Linux Libertine Slanted O}
\newfontfamily\chapfont{Linux Biolinum Slanted O}
\newfontfamily\lettrinefont{Linux Libertine Initials O}
%\newfontfamily\lettrinefont{Preciosa}
%\newfontfamily\lettrinefont{Fancy Pants NF}
%\newfontfamily\lettrinefont{Precious}
%\newfontfamily\lettrinefont{Dobkin}
%\newfontfamily\lettrinefont{Humanistic Cursive}
%\newfontfamily\lettrinefont[Scale=0.5]{Baroque Script}

\usepackage[breaklinks=true,unicode=true]{hyperref}
\hypersetup{colorlinks,
           citecolor=black,
           filecolor=black,
           linkcolor=black,
           urlcolor=black,
           bookmarksopen=true,
           pdfpagelayout=twopageright,
           pdfauthor={chuck smith},
           pdftitle={Calvinisme, Arianisme et Parole de Dieu},
           pdftex}
\usepackage{url}

\usepackage[protrusion=true,final]{microtype}

%\usepackage[T1]{fontenc}
%\usepackage{libertine}

\usepackage{parskip}
\setlength{\parskip}{1ex plus 0.5ex minus 0.2ex}
%\setlength{\parskip}{0.5\baselineskip}

% ref index
\newcommand{\indextitle}{Index des r\'ef\'erences bibliques}
\usepackage{imakeidx}
\indexsetup{level=\chapter*}
\makeindex[title=\indextitle,intoc,options=-s bibleref.ist,columns=2]

% bibleref settings
\usepackage{bibleref-french-colombe}

% headers/footers
\usepackage{scrpage2}
\renewcommand{\headfont}{\headerfont}
\renewcommand{\pnumfont}{\pagemarkfont}

% Get title
\makeatletter
\let\titlehead\@title
\makeatother

% Define \chaphead to be used in section headings
\let\oldchapter\chapter
\newcommand\temphead{}
\newcommand\chaphead{}
\renewcommand\chapter[2][\temphead]{%
    \cleardoublepage
    \renewcommand\temphead{#2}%
    \ifx #1 \@empty
       \renewcommand\chaphead{#2}%
    \else
       \renewcommand\chaphead{#1}%
    \fi
    \oldchapter[#1]{#2}}

\renewcommand*{\chapterpagestyle}{scrplain}

\defpagestyle{chapterend}%
  {%
    {Section~\thechapter\hfill}
    {\hfill\chaphead}
    {}
  }%
  {{}{}{}} % Nothing in footer

\defpagestyle{introend}%
  {%
    {Introduction\hfill}
    {\hfill{}Introduction}
    {}
  }%
  {{}{}{}} % Nothing in footer

\defpagestyle{indexend}%
  {%
    {Index des r\'ef\'erences bibliques\hfill}
    {\hfill{}Index des r\'ef\'erences bibliques}
    {}
  }%
  {{}{}{}} % Nothing in footer

\newcommand{\closechapter}{\thispagestyle{chapterend}}
\newcommand{\closeintro}{\thispagestyle{introend}}
\newcommand{\closeindex}{\thispagestyle{indexend}}

\setheadsepline{.4pt}

\pagestyle{scrheadings}

\renewcommand*{\thechapter}{\arabic{chapter}}

% Set index
\newcommand{\chindex}{%
  % Restore normal chapters
  \let\chapter\oldchapter
  \titleformat{\chapter}%
    {\centering\chapstyle}{}{10pt}%
    {}%
    [\vspace{8mm}]
  \renewcommand*{\BRbooktitlestyle}[1]{\textbf{\emph{##1}}\vadjust{\nobreak}}
  \cleardoublepage
  \printindex
}

% lettrines
\usepackage{type1cm} % scalable fonts
\usepackage{lettrine}
\usepackage{xcolor}
\renewcommand{\LettrineFontHook}{\lettrinefont\color[gray]{0.3}}

% Bullet
\usepackage{xspace}
\newcommand{\mybullet}{{\color[gray]{0.7}$\bullet$}\xspace}

% Define pocketpar environment to fix hyphenation issues
% Sample usage:
%   \begin{pocketpar}{\tolerance=274 \BRallowhypbch}
% or
%   \begin{pocketpar}{\emergencystretch=1.5em}
\newenvironment{pocketpar}[1]{\par}{\par}
\newenvironment{digestpar}[1]{\par}{\par}

% No page finishes with an hyphenated word
\brokenpenalty=10000
% Discourage hyphenation on two lines in a row
\doublehyphendemerits=1000000000


% sections
\usepackage{titlesec}
\newcommand{\chapstyle}{\chapfont\bfseries\huge}

% cadratin
\newcommand*{\ocadr}{\mbox{---}\nobreak\,\nobreak}
\newcommand*{\fcadr}{\unskip\nobreak\,\nobreak{}---}

\newcommand{\signature}[1]{%
\vspace{1cm}\parbox{2.5in}{\sigfont\raggedleft{\large{#1}}}
}

\newcommand{\pocketlinebreak}{}
\newcommand{\pocketpagebreak}{}
\newcommand{\digestlinebreak}{}
\newcommand{\digestpagebreak}{}

\usepackage{pdfpages}
